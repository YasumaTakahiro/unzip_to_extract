# ZIP解凍ツール

ZIPファイルを解凍するためのバッチファイルとPowerShellスクリプトです。ルートフォルダの有無を自動判定し、適切な場所に解凍します。

## 機能

- ZIPファイル内のルートフォルダの有無を自動判定
- ルートフォルダがある場合：そのまま解凍
- ルートフォルダがない場合：ZIPファイル名のフォルダを作成して解凍
- 同名フォルダが存在する場合：日時を付与したフォルダ名で解凍
- JSONC設定ファイルによる設定管理
- Windows環境変数の使用に対応
- 解凍先フォルダが指定されていない場合：ZIPファイルと同じ階層に解凍

## ファイル構成

```
unzip_to_extract/
├── unzip_to_extract.bat          # バッチファイル（エントリーポイント）
├── unzip_to_extract.ps1          # PowerShellスクリプト（メイン処理）
├── unzip_to_extract_config.jsonc # 設定ファイル
└── README.md                     # このファイル
```

## 使用方法

### 基本的な使い方

1. ZIPファイルを`unzip_to_extract.bat`にドラッグ&ドロップするだけです。

### 設定ファイルの編集

`unzip_to_extract_config.jsonc`ファイルを編集して、7-Zipのパスと解凍先フォルダを設定します。

```jsonc
{
  // 7-Zipのインストールディレクトリ（環境変数を使用可能）
  "zipExeDir": "%PROGRAMFILES%\\7-Zip",
  
  // 解凍先フォルダ（環境変数を使用可能、空の場合はZIPファイルと同じ階層に解凍）
  "destDir": "%USERPROFILE%\\Downloads"
}
```

#### 設定項目の説明

- **zipExeDir**: 7-Zipのインストールディレクトリを指定します。このディレクトリ内に`7z.exe`が存在する必要があります。
- **destDir**: 解凍先フォルダを指定します。空の場合は、ZIPファイルと同じ階層に解凍されます。

#### 環境変数の使用

Windowsの環境変数を使用できます。以下のような環境変数が使用可能です：

- `%PROGRAMFILES%` - プログラムファイルフォルダ（例: `C:\Program Files`）
- `%USERPROFILE%` - ユーザープロファイルフォルダ（例: `C:\Users\username`）
- `%HOMEPATH%` - ホームパス（例: `\Users\username`）
- `%TEMP%` - 一時フォルダ
- `%APPDATA%` - アプリケーションデータフォルダ
- その他のWindows環境変数

#### コメントの使用

JSONC形式のため、コメントを追加できます：

```jsonc
{
  // 行コメント
  "zipExeDir": "%PROGRAMFILES%\\7-Zip",
  
  /* 
   * ブロックコメント
   * 複数行にわたる説明を記述できます
   */
  "destDir": "%USERPROFILE%\\Downloads"
}
```

## 動作の詳細

### ルートフォルダの判定

ZIPファイル内の構造を確認し、ルートフォルダの有無を自動判定します：

- **ルートフォルダがある場合**: 解凍先に直接解凍します
  - 例: `archive.zip`（中身: `folder\file.txt`）→ `解凍先\folder\file.txt`
  
- **ルートフォルダがない場合**: ZIPファイル名のフォルダを作成して解凍します
  - 例: `archive.zip`（中身: `file1.txt`, `file2.txt`）→ `解凍先\archive\file1.txt`, `解凍先\archive\file2.txt`

### 同名フォルダの処理

解凍先に同名のフォルダが既に存在する場合：

- 警告メッセージを表示
- フォルダ名に日時を付与（形式: `フォルダ名_yyyyMMdd_HHmmss`）
- 新しいフォルダ名で解凍

例: `archive`フォルダが既に存在する場合 → `archive_20251211_143025`として解凍

### 解凍先フォルダの指定

- **設定ファイルで指定されている場合**: 指定されたフォルダに解凍（フォルダが存在しない場合はエラー）
- **設定ファイルが空の場合**: ZIPファイルと同じ階層に解凍

## エラーハンドリング

以下の場合にエラーが表示され、処理が停止します：

- 7-Zipのディレクトリが存在しない
- 7-Zipのディレクトリ内に`7z.exe`が存在しない
- 解凍先フォルダが存在しない（設定ファイルで指定されている場合）
- ZIPファイルが見つからない
- ZIPファイルのリスト取得に失敗

## 終了時の動作

- **正常終了時**: 3秒後に自動的にコンソールを閉じます
- **エラー時**: `Enter`キーを押すまで待機します（エラーメッセージを確認するため）

## 要件

- Windows 10以降
- PowerShell 5.1以降
- 7-Zip（`7z.exe`が必要）

## トラブルシューティング

### 7-Zipが見つからない

設定ファイルの`zipExeDir`を確認してください。7-Zipのインストールディレクトリが正しく指定されているか確認してください。

### 解凍先フォルダが存在しない

設定ファイルの`destDir`で指定したフォルダが存在することを確認してください。存在しない場合は、事前にフォルダを作成するか、`destDir`を空にしてZIPファイルと同じ階層に解凍するように設定してください。

### 文字化けが発生する

PowerShellの文字エンコーディング設定を確認してください。このツールはUTF-8で動作するように設計されています。

## ライセンス

このツールは自由に使用・改変できます。

